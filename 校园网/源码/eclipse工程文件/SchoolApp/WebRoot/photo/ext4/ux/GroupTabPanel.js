Ext.define("Ext.ux.GroupTabPanel",{extend:"Ext.Container",alias:"widget.grouptabpanel",requires:["Ext.data.*","Ext.tree.*","Ext.layout.*"],baseCls:Ext.baseCSSPrefix+"grouptabpanel",initComponent:function(b){var c=this,a=[];Ext.apply(c,b);c.store=c.createItemsStore();c.layout={type:"hbox",pack:"start",align:"stretch"};c.defaults={border:false};c.items=Ext.each(c.items,function(d){a.push(d.items)});c.items=[{xtype:"treepanel",cls:"x-tree-panel x-grouptabbar",width:150,rootVisible:false,height:400,store:c.store,hideHeaders:true,useArrows:true,animate:false,viewConfig:{overItemCls:""},columns:[{xtype:"treecolumn",sortable:false,dataIndex:"text",flex:1,renderer:function(k,e,j,i,h,g,d){var f="";if(!j.data.activeGroup){f+=" x-inactive-group"}else{if(j.parentNode&&j.parentNode.parentNode===null){f+=" x-grouptab-first";if(j.previousSibling){f+=" x-grouptab-prev"}}else{if(j.nextSibling===null){f+=" x-grouptab-last"}else{f+=" x-grouptab-center"}}}if(j.data.activeTab){f+=" x-active-tab"}e.tdCls="x-grouptab"+f;return k}}]},{xtype:"container",flex:1,layout:"card",activeItem:c.mainItem,baseCls:Ext.baseCSSPrefix+"grouptabcontainer",items:a}];c.addEvents("beforetabchange","tabchange","beforegroupchange","groupchange");c.callParent(arguments);c.setActiveTab(c.activeTab);c.setActiveGroup(c.activeGroup);c.mon(c.down("treepanel").getSelectionModel(),"select",c.onNodeSelect,c)},onNodeSelect:function(a,e){var d=this,b=d.store.getRootNode(),c;if(e.parentNode&&e.parentNode.parentNode===null){c=e}else{c=e.parentNode}if(d.setActiveGroup(c.get("id"))===false||d.setActiveTab(e.get("id"))===false){return false}while(b){b.set("activeTab",false);b.set("activeGroup",false);b=b.firstChild||b.nextSibling||b.parentNode.nextSibling}c.set("activeGroup",true);c.eachChild(function(f){f.set("activeGroup",true)});e.set("activeTab",true);a.view.refresh()},setActiveTab:function(b){var a=this,d=b,c;if(Ext.isString(b)){d=Ext.getCmp(d)}if(d===a.activeTab){return false}c=a.activeTab;if(a.fireEvent("beforetabchange",a,d,c)!==false){a.activeTab=d;if(a.rendered){a.down("container[baseCls="+Ext.baseCSSPrefix+"grouptabcontainer]").getLayout().setActiveItem(d)}a.fireEvent("tabchange",a,d,c)}return true},setActiveGroup:function(c){var b=this,d=c,a;if(Ext.isString(c)){d=Ext.getCmp(d)}if(d===b.activeGroup){return true}a=b.activeGroup;if(b.fireEvent("beforegroupchange",b,d,a)!==false){b.activeGroup=d;b.fireEvent("groupchange",b,d,a)}else{return false}return true},createItemsStore:function(){var a=this,b={text:".",children:[]};a.activeGroup=a.activeGroup||0;Ext.each(a.items,function(g,c){var f=g.items,e=(f[g.mainItem]||f[0]),d={children:[]};if(!e.id){e.id=Ext.id()}d.id=e.id;d.text=e.title;d.iconCls=e.iconCls;delete e.iconCls;delete e.title;d.expanded=true;d.activeGroup=(a.activeGroup===c);d.activeTab=d.activeGroup?true:false;if(d.activeTab){a.activeTab=d.id}if(d.activeGroup){a.mainItem=g.mainItem||0;a.activeGroup=d.id}Ext.each(g.items,function(h){if(!h.id){h.id=Ext.id()}if(h.id!==d.id){var i={id:h.id,leaf:true,text:h.title,iconCls:h.iconCls,activeTab:false};delete h.title;delete h.iconCls;i.activeGroup=d.activeGroup;d.children.push(i)}},a);b.children.push(d)},a);return Ext.create("Ext.data.TreeStore",{fields:["id","text","activeGroup","activeTab"],root:{expanded:true},proxy:{type:"memory",data:b}})},getActiveTab:function(){return this.activeTab},getActiveGroup:function(){return this.activeGroup}});